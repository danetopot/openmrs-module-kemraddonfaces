<!--
      ~ The contents of this file are subject to the OpenMRS Public License
      ~ Version 1.0 (the "License"); you may not use this file except in
      ~ compliance with the License. You may obtain a copy of the License at
      ~ http://license.openmrs.org
      ~
      ~ Software distributed under the License is distributed on an "AS IS"
      ~ basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See the
      ~ License for the specific language governing rights and limitations
      ~ under the License.
      ~
      ~ Copyright (C) OpenMRS, LLC.  All Rights Reserved. By Placide Ntwali Nov 7, 2014.
    -->
<htmlform>

<style type="text/css">
    table.screen {
        border-collapse: collapse;
    }
    table.screen > tbody > tr > td, table.screen > tbody > tr > th {
        border: 1px solid black;
        vertical-align: baseline;
        padding: 4px;
    }
</style>
<script type="text/javascript">
    var YES_CONCEPT_ID = 1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA;
    var NO_CONCEPT_ID = 1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA;
    var UNKNOWN_CONCEPT_ID = 1067AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA;
    var OTHER_CONCEPT_ID = 5622AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA;

    /* Skipping Patterns and dropped fields*/
    function onMEDSChange()
    {

        if (getValue('meds.value')== NO_CONCEPT_ID || getValue('meds.value')== UNKNOWN_CONCEPT_ID)
        {
            $j('#takingmeds').hide();
        }
        else if (getValue('meds.value')== YES_CONCEPT_ID)
        {
            $j('#takingmeds').hide();
        }
        else
        {
            $j('#takingmeds').hide();
        }
    }

    function onSYMPTChange()
    {

        if (getValue('sympt.value')== NO_CONCEPT_ID)
        {
            $j('#symptoms').hide();
        }
        else
        {
            $j('#symptoms').hide();
        }
    }


    function onO_HIVChange()
    {

        if (getValue('O_hiv.value')== YES_CONCEPT_ID)
        {
            $j('#R_hiv').show();
        }
        else if (getValue('O_hiv.value')== NO_CONCEPT_ID)
        {
            $j('#R_hiv').hide();
        }
        else
        {
            $j('#R_hiv').hide();
        }
    }

    function onO_CD4CD8Change()
    {

        if (getValue('O_cd4cd8.value')== NO_CONCEPT_ID)
        {
            $j('#R_cd4').hide();
            $j('#R_cd4Percent').hide();
        }
        else if (getValue('O_cd4cd8.value')== YES_CONCEPT_ID)
        {
            $j('#R_cd4').show();
            $j('#R_cd4Percent').show();
        }
        else
        {
            $j('#R_cd4').hide();
            $j('#R_cd4Percent').hide();
        }
    }



    /* Validate Encounter Date */
    function validateEncounterDate()
    {
        var enc_date=new Date(getValue('encounter_date.value')).getTime();
        var birthDate= new Date("<lookup expression="patient.birthdate"/>").getTime();
        var today=new Date();        //get current date

        /*this data should not be in Future */
        if(enc_date &gt; today)
        {
            getField('encounter_date.error').html('Should not be greater than the Current date').show();
        }
        else if(enc_date &lt; birthDate)
        {
            /* Encounter Date should be greater than the Patients's date of Birth    */
            getField('encounter_date.error').html('Should not be less than the date of Birth').show();
        }
        else
        {
            getField('encounter_date.error').hide();
            calcHaartDuration();
        }

    }


    function validateTCA()
    {
        /* Validate TCA (Return visit date or Next appointment date) */
        /*this data should be in Future but not more than 90 days from the currect date*/

        var enc_date=new Date(getValue('encounter_date.value')).getTime();
        var tca_date= new Date(getValue('tca.value')).getTime();
        var NIGHTY_DAYS = 90 * 24 * 60 * 60 * 1000;
        var future_tca=enc_date + NIGHTY_DAYS;
        if(typeof tca_date != "undefined" || tca_date != null || tca_date != '')
        {
            if(tca_date &lt;= enc_date)
            {
                getField('tca.error').html('Should not be less than the Encounter Date').show();
            }
            //check if the tca is greater than 90 days from the enc date
            else if(tca_date &gt; future_tca )
            {
                getField('tca.error').html('Should not be more than 90 days from Encounter Date').show();
            }
            else
            {
                getField('tca.error').hide();
            }
        }

    }

    $j(function(){

        /* Form Skipping Pattern based on the selected value*/
        $j('#meds input').click(onMEDSChange);
        $j('#sympt input').click(onMEDSChange); //if the symptoms table is determined to be required the trigger will be shifted to #sympt
        $j('#O_hiv input').click(onO_HIVChange);
        $j('#O_cd4cd8 input').click(onO_CD4CD8Change);

        /*validate Fields */
        getField('tca.value').change(validateTCA);
        getField('encounter_date.value').change(validateEncounterDate);

        onMEDSChange();
        onSYMPTChange();
        onO_HIVChange();
        onO_CD4CD8Change();
        validateEncounterDate();
        validateTCA();
    });
</script>

<table class="screen" align="center" width="970px">
    <tbody>
    <tr>
        <td style="background-color: #696969; color: #ffffff;">
            <a name="page1"></a>
            SEARCH High CD4+ ART Delivery - SCREENING VISIT FORM - CRF-01
        </td>
    </tr>
    <tr>
        <td>
            <table width="100%">
                <td rowspan="2" width="25%">Today's date <encounterDate default="today"/></td>
                <td rowspan="2" width="25%">Facility Name <encounterLocation  id="encounter_date" type="dropdown"/></td>
                <td rowspan="2" width="35%">Participant initials:<lookup class="value" expression="patient.personName"/></td>
                <td style="background-color:lightcyan;">Clinic ID:<lookup class="value" complexExpression="#foreach( $patId in $patientIdentifiers.get('Faces ID') ) $patId #end "/></td>
                <tr>
                    <td style="background-color:lightcyan;">SEARCH ID:<lookup class="value" complexExpression="#foreach( $patId in $patientIdentifiers.get('SEARCH ID') ) $patId #end "/></td>
                </tr>
            </table>
        </td>
    </tr>
    <tr>
        <td style="background-color: #696969; color: #ffffff;" align="center">
            FOR CHC NON- PARTICIPANTS / PARTICIPANTS WITHOUT HIV OR CD4 RESULTS
        </td>
    </tr>
    <tr>
        <td>
            <table class="screen" width="98%" align="center">
                <tr>
                    <td colspan="2" align="center"><strong>Taking medications?</strong><obs id="meds" conceptId="159367AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1067AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabels="Yes,No,Unknown" style="radio"/> (If Yes, list below)</td>
                </tr>
            </table>
        </td>
    </tr>
    <tr>
        <td>
                        <span id="takingmeds">
                        <table class="screen" width="98%" align="center">
                            <tr>
                                <td style="font-weight:bold;" align="center">Medication</td>
                                <td style="font-weight:bold;" align="center">Medication</td>
                            </tr>
                            <tr>
                                <td><obs conceptId="1000111FACES_FACES_FACES_FACES_FACES"/></td> <!-- Drug 1 -->
                                <td><obs conceptId="1000112FACES_FACES_FACES_FACES_FACES"/></td> <!-- Drug 2 -->
                            </tr>
                            <tr>
                                <td><obs conceptId="1000156FACES_FACES_FACES_FACES_FACES"/></td> <!-- Drug 3 -->
                                <td><obs conceptId="1000119FACES_FACES_FACES_FACES_FACES"/></td> <!-- Drug 4 -->
                            </tr>
                        </table>
                        </span>
        </td>
    </tr>
    <tr>
        <td style="background-color: #696969; color: #ffffff;" align="center">
            SYMPTOM SCREEN
        </td>
    </tr>
    <tr>
        <td>
            <table class="screen" width="98%" align="center">
                <tr>
                    <td colspan="8" align="center"><strong>SYMPTOM SCREEN</strong><obs id="sympt" conceptId="1729AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptIds="1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabels="" style="radio"/>No current symptoms</td>
                </tr>
            </table>
        </td>
    </tr>
    <tr>
        <td>
                        <span id="symptoms">
                        <table class="screen" width="98%" align="center">
                            <tr style="font-weight:bold;" align="center">
                                <td>Symptoms</td>
                                <td>Absent</td>
                                <td>Severity</td>
                                <td>Duration<br/>(days)</td>
                                <td>Symptoms</td>
                                <td>Absent</td>
                                <td>Severity</td>
                                <td>Duration<br/>(days)</td>
                            </tr>
                            <repeat>
                                <template>
                                    <obsgroup groupingConceptId="1727AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA">
                                        <tr>
                                            <td><obs conceptId="1728AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"  answerConceptIds="512AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,122496AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,832AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,114403AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,5978AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabels="Cutaneous rash, Dyspnea, Unintentional weight loss, Pain, Nausea" answerSeparator="&lt;br /&gt;" style="dropdown"/></td>      <!-- Symptoms name column1 -->
                                            <td><obs conceptId="1729AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"  answerConceptIds="1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabels="" style="radio"/></td>     <!-- Symptom Absence column2 -->
                                            <td><obs conceptId="159411AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"  answerConceptIds="1498AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1499AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1500AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,155136AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabels="1 = mild,2=moderate,3 = severe,4 = life-threatening" answerSeparator="&lt;br /&gt;" style="dropdown"/></td>      <!-- Symptom severity column3 -->
                                            <td><obs conceptId="1731AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"/></td>     <!-- Symptom duration column4 -->
                                            <td><obs conceptId="1069AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"  answerConceptIds="122983AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,142412AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,116743AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,5622AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabels="Vomiting, Diarrhea, Insomnia, Other" answerSeparator="&lt;br /&gt;" style="dropdown"/></td>      <!-- Symptoms name column5 -->
                                            <td><obs conceptId="159547AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"  answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabels="" style="radio"/></td>     <!-- Symptom Absence column6 -->
                                            <td><obs conceptId="152146AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"  answerConceptIds="1498AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1499AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1500AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,155136AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabels="1 = mild,2=moderate,3 = severe,4 = life-threatening" answerSeparator="&lt;br /&gt;" style="dropdown"/></td>      <!-- Symptom severity column7 -->
                                            <td><obs conceptId="1869AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"/></td>     <!-- Symptom duration column8 -->
                                        </tr>
                                    </obsgroup>
                                </template>
                                <render n="1" concept=" " />
                                <render n="2" concept=" " />
                                <render n="3" concept=" " />
                                <render n="4" concept=" " />
                                <render n="5" concept=" " />
                            </repeat>
                        </table>
                        </span>
        </td>
    </tr>
    <tr>
        <td>
            <table>
                <tr>
                    <td style="font-style: italic;">*Severity:	Rank on scale of 1-4:     1 = mild;     2 = moderate;     3 = severe;     4 = life-threatening</td>
                </tr>
            </table>
        </td>
    </tr>
    <tr>
        <td>
            <table class="screen"  width="98%" align="center">
                <tr>
                    <td colspan="8" align="center">LAB TESTS</td>
                </tr>
            </table>
        </td>
    </tr>
    <tr>
        <td>
            <table class="screen" width="98%" align="center">
                <tr style="font-weight: bold;" align="center">
                    <td>Test</td>
                    <td>Ordered?</td>
                    <td>Result</td>
                    <td>Test</td>
                    <td>Ordered?</td>
                    <td>Result</td>
                </tr>
                <tr>
                    <td rowspan="2">HIV Infection</td>
                    <td rowspan="2"><obs id="O_hiv" conceptId="1356AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabels="Yes,No" style="radio"/></td>
                    <td rowspan="2"><obs id="R_hiv" conceptId="159427AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptIds="703AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,664AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabels="Positive, Negative" style="radio"/></td>
                    <td>CD4 cell count</td>
                    <td rowspan="2"><obs id="O_cd4cd8" conceptId="1941AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabels="Yes,No" style="radio"/></td>
                    <td><obs id="R_cd4" conceptId="5497AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"/>cells/uL</td>
                </tr>
                <tr>
                    <td>CD4%</td>
                    <td><obs id="R_cd4Percent" conceptId="730AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"/>%</td>
                </tr>
            </table>
        </td>
    </tr>
    <tr>
        <td>
            <table>
                <td>Next scheduled visit: <obs id="tca" conceptId="5096AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" allowFutureDates="true"/></td>
                <tr>
                    <td>Clinical Officer name: <encounterProvider type="autocomplete"/></td>
                    <td align="right">Date <encounterDate default="today"/></td>
                </tr>
            </table>
        </td>
    </tr>
    <tr>
        <td style="text-align:center;">
            <div class="ke-form-buttons">
                <submit />
            </div>
        </td>
    </tr>
    <tr>
        <td>
            <table>
                <tr>
                    <td style="font-style: italic;">Version 2.0; 12 December 2013</td>
                </tr>
            </table>
        </td>
    </tr>
    </tbody>
</table>
</htmlform>